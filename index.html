Rahat, [23-06-2025 15:38]
<!DOCTYPE html>
<html lang="en" class=""> <!-- Default to light mode, class is toggled by JS -->
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Exam Result Portal</title>
    
    <!-- Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- jsPDF AutoTable Plugin (REQUIRED for autoTable functionality) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <!-- jsPDF SVG Plugin (REQUIRED for addSvgAsImage functionality) -->
    <script src="https://unpkg.com/jspdf-svg@latest/dist/jspdf.plugin.svg.min.js"></script>


    <!-- QR Code Generator Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>

    <!-- Google Fonts for a clean look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* Using a custom font from Google Fonts */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* light mode bg */
        }
        .dark body {
            background-color: #111827; /* dark mode bg */
        }
        /* Custom transition for smoother UI changes */
        .transition-all {
            transition: all 0.3s ease-in-out;
        }
        /* Hide scrollbar for aesthetics but allow scrolling */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="transition-all">

    <!-- Dark Mode Toggle -->
    <button id="theme-toggle" type="button" class="fixed top-4 right-4 text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 z-50">
        <svg id="theme-toggle-dark-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8 0 1010.586 10.586z"></path></svg>
        <svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
    </button>

    <div class="w-full max-w-md mx-auto min-h-screen flex flex-col justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl overflow-hidden">
            <!-- Header Section -->
            <div class="p-6 bg-blue-600 dark:bg-blue-800 text-white text-center">
                   <div class="flex justify-center items-center gap-3">
                       <svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4.26 10.147a60.438 60.438 0 0 0-.491 6.347A48.627 48.627 0 0 1 12 20.904a48.627 48.627 0 0 1 8.232-4.41 60.46 60.46 0 0 0-.491-6.347m-15.482 0a50.57 50.57 0 0 0-2.658-.813A59.906 59.906 0 0 1 12 3.493a59.902 59.902 0 0 1 10.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.697 50.697 0 0 1 12 13.489a50.702 50.702 0 0 1 7.74-3.342M6.75 15a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm0

Rahat, [23-06-2025 15:38]
0v-3.675A55.378 55.378 0 0 1 12 8.443m-7.007 11.55A5.981 5.981 0 0 0 6.75 15.75v-1.5" /></svg>
                       <h1 class="text-2xl font-bold">Exam Result Portal</h1>
                   </div>
                 <p class="text-blue-200 dark:text-blue-300 mt-1">Check your internal assessment scores</p>
            </div>

            <!-- Form Section -->
            <div class="p-6 md:p-8 space-y-4">
                <div>
                    <label for="roll" class="text-sm font-medium text-gray-700 dark:text-gray-300">Roll Number</label>
                    <input type="text" id="roll" placeholder="e.g., 21CS001" class="mt-1 block w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="subject" class="text-sm font-medium text-gray-700 dark:text-gray-300">Subject</label>
                    <select id="subject" class="mt-1 block w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">-- Loading Subjects --</option>
                    </select>
                </div>
                <button onclick="fetchResult()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800">
                    Get Result
                </button>
            </div>

            <!-- Result Display Section -->
            <div id="resultContainer" class="p-6 md:p-8 border-t border-gray-200 dark:border-gray-700"></div>
        </div>
        <footer class="text-center mt-6 text-sm text-gray-500 dark:text-gray-400">
            <p>&copy; 2025 University Portal. All Rights Reserved.</p>
        </footer>
    </div>

    <script>
        // Store student data and full dataset globally
        let currentStudent = {};
        let allStudentData = [];
        const sheetURL = "https://opensheet.elk.sh/1Sfrx9iH5b1-CipMJIQZJ8z61P1PUlgDPrSypfwY6aew/Sheet1";

        // --- ON PAGE LOAD ---
        document.addEventListener('DOMContentLoaded', () => {
            initializeTheme();
            populateSubjects();
        });

        // --- FEATURE: Dark Mode Toggle ---
        function initializeTheme() {
            const themeToggleBtn = document.getElementById('theme-toggle');
            const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
            const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');

            if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
                themeToggleLightIcon.classList.remove('hidden');
            } else {
                document.documentElement.classList.remove('dark');
                themeToggleDarkIcon.classList.remove('hidden');
            }

            themeToggleBtn.addEventListener('click', () => {
                themeToggleDarkIcon.classList.toggle('hidden');
                themeToggleLightIcon.classList.toggle('hidden');
                if (localStorage.getItem('color-theme')) {
                    if (localStorage.getItem('color-theme') === 'light') {
                        document.documentElement.classList.add('dark');
                        localStorage.setItem('color-theme', 'dark');
                    } else {

Rahat, [23-06-2025 15:38]
document.documentElement.classList.remove('dark');
                        localStorage.setItem('color-theme', 'light');
                    }
                } else {
                    if (document.documentElement.classList.contains('dark')) {
                        document.documentElement.classList.remove('dark');
                        localStorage.setItem('color-theme', 'light');
                    } else {
                        document.documentElement.classList.add('dark');
                        localStorage.setItem('color-theme', 'dark');
                    }
                }
            });
        }

        // --- FEATURE: Dynamic Subject Loading ---
        async function populateSubjects() {
            const subjectSelect = document.getElementById('subject');
            try {
                const res = await fetch(sheetURL);
                if (!res.ok) throw new Error("Network response was not ok");
                allStudentData = await res.json();
                
                const subjects = [...new Set(allStudentData.map(row => row.Subject?.trim()).filter(Boolean))];
                subjects.sort();

                subjectSelect.innerHTML = '<option value="">-- Select Subject --</option>';
                subjects.forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject;
                    option.textContent = subject;
                    subjectSelect.appendChild(option);
                });
            } catch (error) {
                console.error("Failed to load subjects:", error);
                subjectSelect.innerHTML = '<option value="">-- Error Loading Subjects --</option>';
                displayMessage('❗', 'Initialization Error', 'Could not load the list of subjects. Please refresh the page.', 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200');
            }
        }

        // --- Main Result Fetch Logic ---
        function fetchResult() {
            const roll = document.getElementById("roll").value.trim();
            const subject = document.getElementById("subject").value;

            if (!roll || !subject) {
                displayMessage('⚠️', 'Heads up!', 'Please enter your Roll Number and select a Subject.', 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200');
                return;
            }

            displayLoader();
            
            // Use the pre-fetched data
            const found = allStudentData.find(row =>
                row["Roll Number"]?.trim().toLowerCase() === roll.toLowerCase() && 
                row["Subject"]?.trim() === subject
            );

            // Using a short timeout to make the loader feel more natural
            setTimeout(() => {
                if (found) {
                    currentStudent = found;
                    displayResult(found);
                } else {
                    displayMessage('❌', 'Not Found', 'We couldn\'t find a result for the provided details. Please double-check and try again.', 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200');
                }
            }, 500);
        }

        function displayResult(student) {
            const resultContainer = document.getElementById("resultContainer");
            const marks = parseInt(student["Marks"]?.trim(), 10);
            const { grade, remark, color } = getGradeAndRemark(marks);

            resultContainer.innerHTML = 
                <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">Result Details</h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center text-sm p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg"><span class="font-semibold text-gray-600 dark:text-gray-300">Roll Number:</span><span class="font-mono bg-gray-200 dark:bg-gray-600 px-2 py-1 rounded">${student["Roll Number"]}</span></div>

Rahat, [23-06-2025 15:38]
<div class="flex justify-between items-center text-sm p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg"><span class="font-semibold text-gray-600 dark:text-gray-300">Name:</span><span class="text-gray-900 dark:text-white font-medium">${student["Name"]}</span></div>
                    <div class="flex justify-between items-center text-sm p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg"><span class="font-semibold text-gray-600 dark:text-gray-300">Subject:</span><span class="text-gray-900 dark:text-white font-medium">${student["Subject"]}</span></div>
                    <div class="flex justify-between items-center text-sm p-3 ${color.bg} rounded-lg">
                        <span class="font-semibold ${color.text}">Grade: <span class="font-bold text-lg">${grade}</span></span>
                        <span class="font-semibold ${color.text}">Remark: <span class="font-bold">${remark}</span></span>
                    </div>
                </div>
                <div class="mt-6 flex flex-col sm:flex-row gap-3">
                    <button onclick="downloadPDF()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-all flex items-center justify-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>Download PDF</button>
                    <button onclick="clearForm()" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-all">Check Another</button>
                </div>
            ;
        }
        
        // --- UI & Utility Helpers ---
        function getGradeAndRemark(marks) {
            if (isNaN(marks)) return { grade: 'N/A', remark: 'Not Declared', color: { bg: 'bg-gray-100 dark:bg-gray-700', text: 'text-gray-800 dark:text-gray-200' } };
            if (marks >= 90) return { grade: 'A+', remark: 'Outstanding', color: { bg: 'bg-green-100 dark:bg-green-900/50', text: 'text-green-800 dark:text-green-200' } };
            if (marks >= 80) return { grade: 'A', remark: 'Excellent', color: { bg: 'bg-green-100 dark:bg-green-900/50', text: 'text-green-800 dark:text-green-200' } };
            if (marks >= 70) return { grade: 'B', remark: 'Good', color: { bg: 'bg-blue-100 dark:bg-blue-900/50', text: 'text-blue-800 dark:text-blue-200' } };
            if (marks >= 60) return { grade: 'C', remark: 'Satisfactory', color: { bg: 'bg-yellow-100 dark:bg-yellow-900/50', text: 'text-yellow-800 dark:text-yellow-200' } };
            if (marks >= 50) return { grade: 'D', remark: 'Pass', color: { bg: 'bg-orange-100 dark:bg-orange-900/50', text: 'text-orange-800 dark:text-orange-200' } };
            return { grade: 'F', remark: 'Fail', color: { bg: 'bg-red-100 dark:bg-red-900/50', text: 'text-red-800 dark:text-red-200' } };
        }

        function displayLoader() { /* ... same as before ... */ }
        function displayMessage(icon, title, message, colorClasses) { /* ... same as before ... */ }
        function clearForm() { /* ... same as before ... */ }
        
        // --- FEATURE-RICH PDF DOWNLOAD ---
        function downloadPDF() {
            if (!currentStudent || !currentStudent["Roll Number"]) { 
                // Using a custom message box instead of alert()
                displayMessage('!', 'Error', 'No result data to download!', 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200');
                return; 
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            const margin = 10; // Margin from the edge of the page for the border

Rahat, [23-06-2025 15:38]
// --- Page Border ---
            doc.setDrawColor(0, 32, 74); // Dark blue for border
            doc.setLineWidth(1); // Border thickness
            doc.rect(margin, margin, pageWidth - (2 * margin), pageHeight - (2 * margin)); // Draw rectangle for border

            // --- 1. Watermark ---
            doc.setFontSize(72);
            doc.setTextColor(230, 230, 230); // Light gray
            doc.setFont("helvetica", "bold");
            // Adjust watermark position to be within the border
            doc.text("CONFIDENTIAL", pageWidth / 2, pageHeight / 2, { angle: -45, align: 'center' });

            // --- 2. University Logo (SVG Placeholder) & Header ---
            const startX = margin + 5; // Starting X position for content inside the border
            let startY = margin + 10; // Starting Y position for content inside the border

            const logoSvg = <svg width="100" height="100" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 12.75C12.4142 12.75 12.75 12.4142 12.75 12V3.75C12.75 3.33579 12.4142 3 12 3C11.5858 3 11.25 3.33579 11.25 3.75V12C11.25 12.4142 11.5858 12.75 12 12.75Z" fill="#0c4a6e"/><path d="M16.2019 14.5048C16.59 14.2141 17.1355 14.2889 17.4262 14.6778L20.5338 18.8907C20.8245 19.2796 20.7497 19.8251 20.3608 20.1158C19.9719 20.4065 19.4264 20.3317 19.1357 19.9428L16.0281 15.7299C15.7374 15.341 15.8121 14.7955 16.2019 14.5048Z" fill="#0c4a6e"/><path d="M7.79812 14.5048C7.41001 14.2141 6.86447 14.2889 6.57379 14.6778L3.46621 18.8907C3.17553 19.2796 3.25034 19.8251 3.63923 20.1158C4.02812 20.4065 4.57366 20.3317 4.86434 19.9428L7.97192 15.7299C8.26260 15.341 8.18789 14.7955 7.79812 14.5048Z" fill="#0c4a6e"/><path fill-rule="evenodd" clip-rule="evenodd" d="M12 21.75C17.3848 21.75 21.75 17.3848 21.75 12C21.75 6.61522 17.3848 2.25 12 2.25C6.61522 2.25 2.25 6.61522 2.25 12C2.25 17.3848 6.61522 21.75 12 21.75ZM12 20.25C16.5563 20.25 20.25 16.5563 20.25 12C20.25 7.44365 16.5563 3.75 12 3.75C7.44365 3.75 3.75 7.44365 3.75 12C3.75 16.5563 7.44365 20.25 12 20.25Z" fill="#0c4a6e"/></svg>;
            doc.addSvgAsImage(logoSvg, startX, startY, 25, 25);
            doc.setFont("helvetica", "bold");
            doc.setFontSize(22);
            doc.setTextColor(0, 32, 74);
            doc.text("Assam University", startX + 35, startY + 10);
            doc.setFontSize(12);
            doc.setFont("helvetica", "normal");
            doc.setTextColor(100, 100, 100);
            doc.text("Department of Law", startX + 35, startY + 18);
            doc.text("Provisional Marksheet (Internal Assessment)", startX + 35, startY + 25);

            // --- 3. Result Information Table ---
            const marks = parseInt(currentStudent["Marks"]?.trim(), 10);
            const { grade, remark } = getGradeAndRemark(marks);

            const fields = [
                ["Roll Number", currentStudent["Roll Number"]],
                ["Full Name", currentStudent["Name"]],
                ["Subject", currentStudent["Subject"]],
                ["Marks Obtained (out of 100)", isNaN(marks) ? "N/A" : marks],
                ["Grade", grade],
                ["Remarks", remark]
            ];
            
            startY = startY + 50; // Position table below the header
            doc.autoTable({
                startY: startY,
                head: [['Parameter', 'Details']],
                body: fields,
                theme: 'grid',
                headStyles: { fillColor: [0, 32, 74] },
                styles: { fontSize: 11, cellPadding: 3 },
                columnStyles: { 0: { fontStyle: 'bold' } },
                margin: { left: startX, right: margin } // Adjust table margins
            });

            // --- 4. QR Code for Verification ---
            // Ensure autoTable.previous.finalY is valid before using it

Rahat, [23-06-2025 15:38]
const qrYPosition = doc.autoTable.previous.finalY ? doc.autoTable.previous.finalY + 15 : startY + 80; 
            const qrString = `Roll: ${currentStudent["Roll Number"]}, Name: ${currentStudent["Name"]}, Subject: ${currentStudent["Subject"]}, Marks: ${isNaN(marks) ? "N/A" : marks},

Rahat, [23-06-2025 15:38]
Grade: ${grade}, Remark: ${remark};
            const qr = qrcode(0, 'L');
            qr.addData(qrString);
            qr.make();
            const qrImgData = qr.createDataURL(4);
            doc.addImage(qrImgData, 'PNG', startX, qrYPosition, 40, 40);

            // --- 5. Footer & Declarations ---
            const finalY = Math.max(doc.autoTable.previous.finalY, qrYPosition + 40); // Take the max of table end or QR end for consistent footer placement
            doc.setFontSize(10);
            doc.setTextColor(100, 100, 100);
            doc.text(Date of Declaration: ${new Date().toLocaleDateString('en-IN', { timeZone: 'Asia/Kolkata' })}, startX, finalY + 15);
            doc.text("This is a computer-generated document. No signature is required.", startX, finalY + 20);
            
            const signatureX = pageWidth - margin - 50; // Position signature block from right margin
            doc.setLineWidth(0.5);
            doc.line(signatureX, finalY + 40, signatureX + 45, finalY + 40);
            doc.text("Controller of Examinations", signatureX + 22.5, finalY + 45, {align: 'center'});

            doc.save(${currentStudent["Roll Number"]}_${currentStudent["Subject"]}_Result.pdf);
        }
        
        // Re-assigning loader and message functions to the window scope for simplicity
        window.displayLoader = displayLoader;
        window.displayMessage = displayMessage;
        window.clearForm = clearForm;
        window.downloadPDF = downloadPDF; // Ensure downloadPDF is also globally accessible

        // Note: The previous simple helper functions are used here without re-declaration
        // To save space. They are: displayLoader, displayMessage, clearForm
        function displayLoader() {
            document.getElementById("resultContainer").innerHTML = <div class="flex flex-col items-center justify-center text-center p-4"><svg class="animate-spin h-8 w-8 text-blue-600 dark:text-blue-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><p class="mt-3 text-lg font-semibold text-gray-700 dark:text-gray-300">Fetching Your Result...</p><p class="text-sm text-gray-500 dark:text-gray-400">Please wait a moment.</p></div>;
        }
        function displayMessage(icon, title, message, colorClasses) {
            document.getElementById("resultContainer").innerHTML = <div class="rounded-lg p-4 ${colorClasses}"><div class="flex"><div class="flex-shrink-0 text-2xl">${icon}</div><div class="ml-3"><h3 class="text-sm font-bold">${title}</h3><div class="text-sm mt-1">${message}</div></div></div></div>`;
        }
        function clearForm() {
            document.getElementById("roll").value = "";
            document.getElementById("subject").value = "";
            document.getElementById("resultContainer").innerHTML = "";
            currentStudent = {};
        }

    </script>
</body>
</html>
